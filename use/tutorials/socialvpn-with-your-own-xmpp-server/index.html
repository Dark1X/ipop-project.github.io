<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<title>Build VPN with social friends using your own XMPP server</title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />






<link href="../../../wp-content/themes/orion/css/reset.css" rel="stylesheet" type="text/css" media="screen" />
<link href="../../../wp-content/themes/orion/css/grid.css" rel="stylesheet" type="text/css" media="screen" />
<link href="../../../wp-content/themes/orion/css/master.css" rel="stylesheet" type="text/css" media="screen" />
<link href="../../../wp-content/themes/orion/css/superfish.css" rel="stylesheet" type="text/css" media="screen" />
<link href="../../../wp-content/themes/orion/style2.css" rel="stylesheet" type="text/css" media="screen" />

<!-- wp_head includes jQuery and dependencies from st_theme_scripts() in lib/functions/header_functions.php -->


<script type='text/javascript' src='http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js?ver=3.7.1'></script>
<script type='text/javascript' src='../../../wp-content/themes/orion/js/superfish.js?ver=1.0'></script>
<script type='text/javascript' src='../../../wp-content/themes/orion/js/jquery.imgr.min.js?ver=1.1'></script>
<script type='text/javascript' src='../../../wp-content/themes/orion/js/jquery.formalize.js?ver=1.2'></script>
<script type='text/javascript' src='../../../wp-content/themes/orion/js/custom.js?ver=1.0'></script>
<script type='text/javascript' src='../../../wp-includes/js/comment-reply.min.js?ver=3.7.1'></script>

 

<link rel='next' title='Usage scenarios' href='../../../about-2/usage-scenarios' />

<link rel='canonical' href='./' />
<link rel='shortlink' href='../../../?p=386' />
<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-47375109-1'], ['_trackPageview']);
	(function() {
	var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>
<style type="text/css" media="screen">#header {height:80px}</style>	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>

<!-- Avoid Conflicts - Add Custom Javascript and CSS Below wp_head -->
<script type="text/javascript" src="../../../wp-content/themes/orion/js/slides.min.jquery.js"></script>

<!-- Load PrettyPhoto if Requested -->


<!--[if IE 7]>
<link href="../../../wp-content/themes/orion/css/ie7.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->

<!--[if IE 8]>
<link href="../../../wp-content/themes/orion/css/ie8.css" rel="stylesheet" type="text/css" media="screen" />
<![endif]-->

<!--[if lte IE 9]>
<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<style type="text/css">
html button,
html .gallery .gallery-item img,
html .gallery .gallery-item img.thumbnail,
html ul.tabs li a.active,
html input[type="submit"],
html input[type="reset"],
html input[type="button"],
html .cta,
html a.button,
html a.more-link,
html #teaser,
html #breadcrumbs,
html #menu .columns,
html #menu.wide,
html .latest-img,
html .widget-container.S1,
html .widget-container.S2,
html .widget-container.S3,
html #author-info,
html ul.advanced-recent-posts li img,
html .instapress img,
html .st-callout,
html .wp-post-image {behavior: url("../../../wp-content/themes/orion/css/PIE.php") !important;position: relative;}
</style>
<![endif]-->



</head>
<body class="page page-id-386 page-child parent-pageid-58 page-template-default h-arial b-arial light">
<a name="top"></a>
<div id="header_wrap">
<div id="header">
    <div id="nav">
    <div id="menu_wrap" class="below" style="width:950px;float:right;margin:20px 0px 0px 150px;"><div id = "menu"><div class="menu-main-container"><ul id="menu-main" class="menu"><li id="menu-item-50" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-50"><a href="../../../">About</a>
<ul class="sub-menu">
	<li id="menu-item-166" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-166"><a href="../../../about-2/project-history">Project history</a></li>
	<li id="menu-item-505" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-505"><a href="../../../about-2/usage-scenarios">Usage scenarios</a></li>
	<li id="menu-item-345" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-345"><a href="../../../ipop-users">IPOP Users</a>
	<ul class="sub-menu">
		<li id="menu-item-348" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-348"><a target="_blank" href="http://www.archer-project.org">Archer</a></li>
		<li id="menu-item-347" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-347"><a target="_blank" href="http://portal.futuregrid.org">FutureGrid</a></li>
		<li id="menu-item-349" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-349"><a target="_blank" href="http://www.conpaas.eu">ConPaaS</a></li>
		<li id="menu-item-346" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-346"><a target="_blank" href="http://www.pragma-grid.net/">PRAGMA</a></li>
	</ul>
</li>
	<li id="menu-item-145" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-145"><a href="../../../about-2/acknowledgments">Sponsors</a></li>
</ul>
</li>
<li id="menu-item-195" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-195"><a href="../../../learn/architecture">Learn</a>
<ul class="sub-menu">
	<li id="menu-item-183" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-183"><a href="../../../learn/architecture">Architecture</a>
	<ul class="sub-menu">
		<li id="menu-item-111" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-111"><a href="../../../learn/tincan">TinCan</a></li>
		<li id="menu-item-315" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-315"><a href="../../../learn/controllers">Controller</a></li>
		<li id="menu-item-163" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-163"><a target="_blank" href="http://github.com/ipop-project/documentation/wiki/Controller-API">Controller-TinCan API</a></li>
	</ul>
</li>
	<li id="menu-item-189" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-189"><a href="../../../learn/xmpposn-bindings">XMPP/OSN Bindings</a></li>
	<li id="menu-item-192" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-192"><a href="../../../learn/nat-traversal">NAT Traversal</a></li>
	<li id="menu-item-162" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-162"><a href="../../../learn/controllers">Controllers</a>
	<ul class="sub-menu">
		<li id="menu-item-112" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-112"><a href="../../../socialvpn">SocialVPN</a></li>
		<li id="menu-item-113" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-113"><a href="../../../learn/groupvpn">GroupVPN</a></li>
	</ul>
</li>
	<li id="menu-item-84" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-84"><a href="../../../learn/publications">Documents and publications</a></li>
	<li id="menu-item-540" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-540"><a target="_blank" href="../../../wp-content/uploads/2014/07/IPOP-WhitePaper-1407.pdf">IPOP White Paper</a></li>
	<li id="menu-item-85" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-85"><a href="../../../learn/videos">Videos</a></li>
</ul>
</li>
<li id="menu-item-216" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-ancestor menu-item-has-children menu-item-216"><a href="../">Use</a>
<ul class="sub-menu">
	<li id="menu-item-314" class="menu-item menu-item-type-post_type menu-item-object-page current-page-ancestor current-menu-ancestor current-menu-parent current-page-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-314"><a href="../">Hands-on tutorials</a>
	<ul class="sub-menu">
		<li id="menu-item-298" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-298"><a href="../socialvpn-google-hangout-tutorial">Build VPN with social friends using Google account</a></li>
		<li id="menu-item-306" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-306"><a href="../groupvpn-with-your-own-xmpp-server">Build GroupVPN cluster with XMPP server</a></li>
		<li id="menu-item-388" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-386 current_page_item menu-item-388"><a href="./">Build VPN with social friends using  your own XMPP server</a></li>
	</ul>
</li>
	<li id="menu-item-331" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-331"><a href="../../installing-ipop">Installing SocialVPN</a>
	<ul class="sub-menu">
		<li id="menu-item-96" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-96"><a target="_blank" href="https://github.com/ipop-project/documentation/wiki/Running-SocialVPN-on-Linux">Linux</a></li>
		<li id="menu-item-98" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-98"><a target="_blank" href="https://github.com/ipop-project/documentation/wiki/Running-SocialVPN-on-Windows-7">Windows</a></li>
		<li id="menu-item-97" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-97"><a target="_blank" href="https://github.com/ipop-project/documentation/wiki/Running-SocialVPN-on-Android">Android</a></li>
	</ul>
</li>
	<li id="menu-item-332" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-332"><a href="../../installing-ipop">Installing GroupVPN</a>
	<ul class="sub-menu">
		<li id="menu-item-333" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-333"><a target="_blank" href="https://github.com/ipop-project/documentation/wiki/Running-GroupVPN-on-Linux">Linux</a></li>
		<li id="menu-item-99" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-99"><a target="_blank" href="https://github.com/ipop-project/documentation/wiki/Running-GroupVPN-on-OpenWRT-Emulator">OpenWRT</a></li>
	</ul>
</li>
	<li id="menu-item-542" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-542"><a target="_blank" href="http://software.opensuse.org/download/package?project=network:vpn:ipop&#038;package=ipop">Packages</a></li>
	<li id="menu-item-479" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-479"><a target="_blank" href="https://github.com/ipop-project/downloads/releases">Downloads</a></li>
	<li id="menu-item-100" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-100"><a target="_blank" href="https://github.com/ipop-project/documentation/wiki">Building</a>
	<ul class="sub-menu">
		<li id="menu-item-334" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-334"><a target="_blank" href="https://github.com/ipop-project/documentation/wiki/Building-the-code-for-Linux">Linux</a></li>
		<li id="menu-item-335" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-335"><a target="_blank" href="https://github.com/ipop-project/documentation/wiki/Building-the-code-for-Android">Android</a></li>
		<li id="menu-item-336" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-336"><a target="_blank" href="https://github.com/ipop-project/documentation/wiki/Building-the-code-for-OpenWRT-malta">OpenWRT</a></li>
		<li id="menu-item-337" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-337"><a target="_blank" href="https://github.com/ipop-project/documentation/wiki/Building-the-code-for-Raspberry-Pi">Raspberry Pi</a></li>
	</ul>
</li>
	<li id="menu-item-299" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-299"><a target="_blank" href="http://github.com/ipop-project/documentation/wiki/FAQs">FAQs</a></li>
	<li id="menu-item-300" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-300"><a target="_blank" href="http://github.com/ipop-project/documentation/wiki/Known-issues">Known issues</a></li>
</ul>
</li>
<li id="menu-item-41" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-41"><a href="../../../contribute">Contribute</a>
<ul class="sub-menu">
	<li id="menu-item-93" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-93"><a target="_blank" href="http://github.com/ipop-project">Code repository</a></li>
	<li id="menu-item-94" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-94"><a target="_blank" href="https://github.com/ipop-project/ipop-tincan/issues">Reporting issues</a></li>
	<li id="menu-item-139" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-139"><a target="_blank" href="https://github.com/ipop-project/documentation/wiki/Development-workflow">Submitting code</a></li>
</ul>
</li>
<li id="menu-item-89" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-89"><a href="../../../contact">Contact</a>
<ul class="sub-menu">
	<li id="menu-item-287" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-287"><a target="_blank" href="https://lists.ufl.edu/cgi-bin/wa?SUBED1=IPOP-USERS-L&#038;A=1">Mailing list</a></li>
	<li id="menu-item-499" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-499"><a target="_blank" href="http://webchat.freenode.net/">#ipop IRC channel</a></li>
	<li id="menu-item-103" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-103"><a href="../../../contact/people">People</a></li>
</ul>
</li>
</ul></div></div></div>    </div>
		<span id="text-header"><a href="../../../" title="">IPOP</a></span> <span id="text-slogan"></span></div>
</div>
<!--/header-->





<div id="main">
	<div id="container" class="container_24  clearfix">
		<div class="mid_w_wide">
			<div class="grid_24">				<div id="content" class="wide">
				<p id="breadcrumbs"><a href="../../../">Home</a> <span class="sep">&raquo;</span> <a href="../../">Use</a> <span class="sep">&raquo;</span> <a href="../">Tutorials</a> <span class="sep">&raquo;</span> <strong>Build VPN with social friends using your own XMPP server</strong></p>
									<div class="post" id="post-386">
												<h1 class="posttitle">Build VPN with social friends using your own XMPP server</h1>						<div class="entry clearfix">
												<p><strong>Goal: </strong>This tutorial demonstrates how you can use IPOP SocialVPN and configure the ejabberd XMPP server to create a simple social virtual private network among three computers. The approach described in this tutorial can be generalized to create more complex social networks, which is useful if you wish to create your own customized OSNs.</p>
<p><strong>Pre-requisites: </strong>To follow this tutorial, you need:</p>
<ul>
<li>A computer connected to the Internet</li>
<li>Virtual machine software. The instructions below are for VMware for expediency (While in theory VirtualBox should work, we&#8217;ve seen problems with VirtualBox&#8217;s NAT &#8211; this needs to be better tested <a href="http://www.virtualbox.org/manual/ch06.html#network_nat_service">click here to see instructions for setting up VirtualBox NAT</a>)</li>
<li>Basic expertise in using Linux command line and text editing</li>
</ul>
<p><strong>Overview of steps:</strong> In this tutorial, you will run four virtual machines with the Linux operating system (Ubuntu distribution). You will install and run and XMPP server (ejabberd) on one of them, and then install and run SocialVPN on the other three VMs. You will then be able to see how the SocialVPN nodes connect to its trusted peers through a virtual private network interface.</p>
<p><strong>Step 1: Download Linux virtual machine</strong></p>
<p>While there are several possible Debian/Ubuntu images that you can use for this tutorial, an image that has been tested and is known to work is a <a href="http://www.traffictool.net/vmware/ubuntu1204t.html" target="_blank"> Ubuntu 12.04 appliance</a> that runs on VMware. <a href="http://www.traffictool.net/vmware/ubuntu1204t.zip">Download the ubuntu1204t.zip file</a> and save to a folder in your computer.</p>
<p><strong>Step 2: Run four virtual machine instances (Alice, Bob, Carol, Xavier)</strong></p>
<p>Create four folders (Alice, Bob, Carol, Xavier) and unzip ubuntu1204t.zip in these folders to create three virtual machines for this tutorial. You should configure the virtual machines with NAT interface. Double-click the Ubuntu.vmx file under Ubuntu1204 to start each virtual machine.</p>
<p><em>VMware tip: several dialog boxes may pop up; don&#8217;t worry about upgrading the VM or connecting devices such as serial and ide:0</em></p>
<p><em>Ubuntu VM tip: the default password for the root account is: password</em></p>
<p><strong><strong>Step 3: Install and configure ejabberd XMPP server on Xavier</strong></strong></p>
<p>Open a terminal window inside the Xavier VM (click on top left icon for &#8220;Dash Home&#8221;, and on the search bar type &#8220;terminal&#8221; and Enter). Follow the <a href="http://github.com/ipop-project/documentation/wiki/Installing-XMPP-server" target="_blank">instructions on how to install ejabberd XMPP/STUN service</a>.</p>
<p>Take note of the IP address of the Xavier machine by running <em>ifconfig eth0</em> . We&#8217;ll refer to this IPv4 address as <em>x.x.x.x</em> in the tutorial. If you are running in NAT/host only mode, this will be a private address. That&#8217;s ok, as long as your Alice, Bob and Carol VMs are running on the same computer.</p>
<p>Now add social connections through the ejabberd command-line interface. You will create a simple social graph, where Bob is friends with both Alice and Carol, but Alice and Carol are not friends.</p>
<p>First, register the three users (we&#8217;ll use the same password for all the users for simplicity). Run the following commands in a terminal:</p>
<pre>sudo ejabberdctl register alice ejabberd password</pre>
<pre>sudo ejabberdctl register bob ejabberd password</pre>
<pre>sudo ejabberdctl register carol ejabberd password</pre>
<p>Second, create social connections:</p>
<pre>sudo ejabberdctl add-rosteritem alice ejabberd bob ejabberd bob svpn both</pre>
<pre>sudo ejabberdctl add-rosteritem bob ejabberd alice ejabberd alice svpn both</pre>
<pre>sudo ejabberdctl add-rosteritem carol ejabberd bob ejabberd bob svpn both</pre>
<pre>sudo ejabberdctl add-rosteritem bob ejabberd carol ejabberd carol svpn both</pre>
<p><strong>Step 4: Install and configure SocialVPN on Alice, Bob, and Carol<br />
</strong></p>
<p>Open a terminal window inside each machine. Follow the <a href="https://github.com/ipop-project/documentation/wiki/Running-SocialVPN-on-Linux" target="_blank">instructions on how to install and configure SocialVPN</a>, inside each virtual machine &#8211; first on Alice, then on Bob, then on Carol.</p>
<p>Configure Alice&#8217;s config.json as follows:<br />
<code>{<br />
"ip4": "172.31.0.100",<br />
"ip4_mask": 24,<br />
"xmpp_username": "alice@ejabberd",<br />
"xmpp_password": "password",<br />
"xmpp_host": "x.x.x.x",<br />
"stun": ["x.x.x.x:3478"]<br />
}</code></p>
<p>Configure Bob&#8217;s config.json as follows:<br />
<code><br />
{<br />
"ip4": "172.31.0.100",<br />
"ip4_mask": 24,<br />
"xmpp_username": "bob@ejabberd",<br />
"xmpp_password": "password",<br />
"xmpp_host": "x.x.x.x",<br />
"stun": ["x.x.x.x:3478"]<br />
}</code></p>
<p>Configure Carol&#8217;s config.json as follows:<br />
<code>{<br />
"ip4": "172.31.0.100",<br />
"ip4_mask": 24,<br />
"xmpp_username": "carol@ejabberd",<br />
"xmpp_password": "password",<br />
"xmpp_host": "x.x.x.x",<br />
"stun": ["x.x.x.x:3478"]<br />
}</code><br />
<em>Tip</em>: you can use an external editor (e.g. Notepad) to create config.json in your host, and copy and paste it the text into the VM. You can also use Linux&#8217;s Text Editor &#8211; again accessible through the &#8220;Dash Home&#8221; icon.</p>
<p><strong>Step 5: Run ipop-tincan and SocialVPN controller on Alice, Bob, and Carol<br />
</strong></p>
<p>Start TinCan (note: the password you need to type is: <em>password</em>):</p>
<pre>sudo sh -c './ipop-tincan-x86 1&gt; out.log 2&gt; err.log &amp;'</pre>
<pre>./svpn_controller.py -c config.json &amp;&gt; log.txt &amp;</pre>
<p><strong>Step 6: Use SocialVPN to ping/ssh between Alice, Bob, and Carol</strong></p>
<p>You can try to ping each other now and check that they are connected. For example, on Alice you can ping Bob:</p>
<pre>ping 172.31.0.101</pre>
<p>On Bob, you can ping both Alice and Carol:</p>
<pre>ping 172.31.0.101</pre>
<pre>ping 172.31.0.102</pre>
<p>You can also test with an ssh session. Install ssh server on Alice, Bob, Carol:</p>
<pre>sudo apt-get install openssh-server</pre>
<p>To differentiate among the different computers, set the hostname in each one of them. For instance, in Alice you&#8217;d do:</p>
<pre>sudo hostname alice</pre>
<p>Now from Alice you can ssh into bob:</p>
<pre>ssh 172.31.0.101</pre>
<pre>hostname</pre>
<p><strong>On dynamic IP addresses and names:</strong></p>
<p>Note that SocialVPN maps IPv4 addresses dynamically within a user&#8217;s social scope. You can check which nodes are connected to the SocialVPN as follows:</p>
<pre>echo -e '\x02\x01{"m":"get_state"}' | netcat -q 1 -u 127.0.0.1 5800</pre>
<p>SocialVPN also configures the ipop virtual interface with an IPv6 address &#8211; which is not mapped dynamically. If you develop new applications over SocialVPN, IPv6 provides a better platform as is subsumes the need for address translation.</p>
<p>Currently, SocialVPN does not support SocialDNS for name mapping. This is a feature that will be released in future versions.</p>
						</div><!-- /.entry -->
											</div><!-- /post -->

					<!-- AdSense -->
	    							<!-- /AdSense -->

					
<!-- You can start editing here. -->
<div id="comments">

	

</div>

										<div class="clear"></div>
								</div><!--/#content-->
							</div><!--/GetContentGrid-->

								
															<div class="clear"></div>
						</div><!--/MidWrap-->
					</div><!--/#container-->
					</div><!--/wrap-->
					</div>
<div class="clear"></div>
<div id="footer">


		
<div id="bottom">
This material is based upon work supported in part by the National Science Foundation under Grant No. 1339737.<br /><div class="copy"><a href="http://www.simplethemes.com" title="Wordpress Themes">Wordpress Theme by Simple Themes</a></div>
</div><!--/bottom-->
</div><!--/footer-->



</body>
</html>